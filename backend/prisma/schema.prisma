generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String
  name         String
  bio          String?
  avatar       String?
  creditBalance Float   @default(5.0)
  trustScore   Float    @default(0.0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  skills             Skill[]
  certificates       Certificate[]
  sentSwapRequests    SwapRequest[]      @relation("Requester")
  receivedSwapRequests SwapRequest[]     @relation("Provider")
  creditTransactions  CreditTransaction[]
  sentMessages       Message[]          @relation("Sender")
  receivedMessages   Message[]          @relation("Receiver")
  givenReviews       Review[]           @relation("Reviewer")
  receivedReviews    Review[]           @relation("Reviewee")
}

model Skill {
  id             String   @id @default(uuid())
  name           String
  description    String?
  creditRate     Float    @default(1.0)
  yearsOfExp     Float    @default(0)
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  createdAt      DateTime @default(now())

  swapRequests   SwapRequest[]
}

model Certificate {
  id           String   @id @default(uuid())
  title        String
  issuer       String?
  filePath     String
  verified     Boolean  @default(false)
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  createdAt    DateTime @default(now())
}

model SwapRequest {
  id           String   @id @default(uuid())
  status       String   @default("pending")
  hours        Float
  creditAmount Float
  message      String?
  skillId      String
  skill        Skill    @relation(fields: [skillId], references: [id])
  requesterId  String
  requester    User     @relation("Requester", fields: [requesterId], references: [id])
  providerId   String
  provider     User     @relation("Provider", fields: [providerId], references: [id])
  escrowHeld   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model CreditTransaction {
  id          String   @id @default(uuid())
  amount      Float
  type        String
  description String?
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  relatedSwapId String?
  createdAt   DateTime @default(now())
}

model Message {
  id         String   @id @default(uuid())
  content    String
  read       Boolean  @default(false)
  senderId   String
  sender     User     @relation("Sender", fields: [senderId], references: [id])
  receiverId String
  receiver   User     @relation("Receiver", fields: [receiverId], references: [id])
  createdAt  DateTime @default(now())
}

model Review {
  id         String   @id @default(uuid())
  rating     Int
  comment    String?
  reviewerId String
  reviewer   User     @relation("Reviewer", fields: [reviewerId], references: [id])
  revieweeId String
  reviewee   User     @relation("Reviewee", fields: [revieweeId], references: [id])
  swapRequestId String?
  createdAt  DateTime @default(now())
}
